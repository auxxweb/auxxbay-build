import{ad as N,ae as F,r as y,u as j,j as I,aG as E,bi as z,ba as O,bj as L,bk as R,bl as A,h as b}from"./index--xT2dYYS.js";function T(){const k=N(),a=F(o=>o.business),c=F(o=>o.subscriptionPlan),x=y.useRef(!1),[C,w]=y.useState(!1),[_,i]=y.useState(!1),v=j(),B=()=>new Promise(o=>{const s=document.createElement("script");s.src="https://checkout.razorpay.com/v1/checkout.js",s.onload=()=>{w(!0),o(!0)},s.onerror=()=>{w(!1),o(!1)},document.body.appendChild(s)}),m=()=>v("/create-business/template"),S=async(o,s)=>{var l,u;if(!C&&!await B()){alert("Razorpay SDK failed to load. Are you online?");return}const g={key:"rzp_live_AtNBUPBiYLEp7u",amount:(c==null?void 0:c.amount)*100,currency:"INR",name:"Auxxbay",description:"Auxxbay is a comprehensive platform designed to simplify and enhance professional networking, providing seamless tools for business growth, collaboration, and community building",image:"https://auxxbay.auxxweb.in/images/auxxbay-logo.png",handler:async function(d){console.log(d,"response"),i(!0);const r=setInterval(async()=>{var p;try{const t=await L(s);console.log(t,"payment dataaaaaaaa");const e=(p=t==null?void 0:t.data)==null?void 0:p.PaymentStatus,P=t==null?void 0:t.business;if(e==="success"){i(!1),clearInterval(r);let n=localStorage.getItem("businessId");console.log({businessId:n}),n&&(n=JSON.parse(n),v(`/business/${n}`)),k(R()),k(A())}e==="failed"&&(i(!1),clearInterval(r),b.error("Payment Failed ,try again ",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"colored",style:{backgroundColor:"#e74c3c",color:"#FFFFFF"}}),m())}catch(t){i(!1),m(),console.error("Error fetching payment status:",t)}},2e3);setTimeout(()=>{clearInterval(r),i(!1),b.error("Something went wrong , please try again!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"colored",style:{backgroundColor:"#e74c3c",color:"#FFFFFF"}}),m(),console.log("Stopped checking payment status after 2 minutes")},2*60*1e3)},modal:{ondismiss:function(){b.warning("Payment process was cancelled. Please try again.",{position:"top-right",autoClose:3e3}),m()}},prefill:{name:a==null?void 0:a.businessName,email:(l=a==null?void 0:a.contactDetails)==null?void 0:l.email,contact:(u=a==null?void 0:a.contactDetails)==null?void 0:u.primaryNumber},notes:{payment_id:o},theme:{color:a.theme}};new window.Razorpay(g).open()};return y.useEffect(()=>{x.current||((async()=>{var g,h,l,u,d,r,p,t;console.log(a,"formData");const s=localStorage.getItem("paymentToken");if(s){const e=await z(c,s);e.success&&S((g=e==null?void 0:e.data)==null?void 0:g._id,s);return}else try{const e=await O(a);console.log(e,"resssssssssssssssssssssss");const P=((h=e==null?void 0:e.data)==null?void 0:h._id)||((l=e==null?void 0:e.data.data)==null?void 0:l._id),n=((u=e.data)==null?void 0:u.token)||((r=(d=e.data)==null?void 0:d.data)==null?void 0:r.token);localStorage.setItem("paymentToken",(p=e==null?void 0:e.data)==null?void 0:p.token),localStorage.setItem("businessId",JSON.stringify(P));const f=await z(c,n);f.success&&S((t=f==null?void 0:f.data)==null?void 0:t._id,n)}catch(e){console.log(e,"razorpay-error")}})(),x.current=!0)},[]),_?I.jsx("div",{style:{height:"100vh",top:"50%",left:"50%",display:"flex"},children:I.jsx(E,{})}):null}export{T as default};
